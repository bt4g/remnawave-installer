## Remnawave Installer

Этот скрипт предназначен для автоматизированной установки панели и ноды **Remnawave**.

Для полноценного использования вам понадобятся два отдельных сервера: 
- Сервер для панели - он будет центром управления, но не будет содержать Xray ноду
- Сервер для ноды - он будет содержать Xray ноду и заглушку Self Steal для VLESS REALITY

Также необходимо три домена (поддомена): один для панели, второй — для подписок и третий — для сайта-заглушки Self Steal, который размещается на сервере с нодой.

Рекомендуемый порядок установки:

1. Сначала установите панель и получите публичный ключ для вашей ноды.
2. Затем установите ноду, указав ранее полученный ключ.

**Важно!** После завершения установки **ноды**, чтобы панель ее подхватила, потребуется выполнить перезапуск **панели** в меню скрипта установки или командой:

```bash
cd ~/remnawave/panel && make restart
```

## Функциональность

## Функциональность
Установщик предоставляет следующие возможности:
- Установка панели Remnawave + Caddy и [Subscription templates](https://remna.st/subscription-templating/installation) для подписок
- Установка ноды Remnawave + Self Steal (заглушка), доступная локально (для Xray)

## Системные требования

- ОС: Ubuntu (рекомендуется Ubuntu 22.04 или выше)
- Пользователь с правами root (sudo)

## Установка

Для запуска установщика выполните следующую команду в терминале:

```bash
bash <(curl -Ls https://raw.githubusercontent.com/xxphantom/remnawave-installer/refs/heads/main/dist/install_remnawave.sh)
```

## Процесс установки

### Установка панели Remnawave

1. После запуска скрипта выберите пункт **1) Установка панели Remnawave**.
2. Скрипт автоматически установит необходимые зависимости (Docker и другие).
3. Вам потребуется ввести:
   - Токен Telegram-бота / ID администратора и ID чата (если включите интеграцию с Telegram)
   - Доменное имя для **поддержки** подписок (для приложения клиента)
   - Доменное имя для **веб-страницы** подписок (для приложения клиента)
   - Основной **домен** для панели управления
   - Отдельный **домен** для подписок
   - Имя пользователя и пароль SuperAdmin
4. Вам будет предложено установить `remnawave-subscription-page`:
   - При положительном выборе будет установлен `remnawave-subscription-page`.
   - Будут созданы директории для шаблонов и скачаны стандартные шаблоны.
   - Вы сможете настроить параметры V2Ray Mux и текст объявления.
   - Caddy будет настроен для работы с `remnawave-subscription-page`.
5. Скрипт зарегистрирует SuperAdmin в панели за вас и проведёт первичную настройку:
   - Сгенерирует конфиг Xray VLESS.
   - Добавит данные о ноде (для связи с вашей удаленной нодой) в панель и получит публичный ключ для неё.
   - Создаст хост для ноды.

### Установка ноды Remnawave

1. Выберите пункт **2) Установка ноды Remnawave**.
2. Скрипт установит необходимые зависимости.
3. Вам потребуется ввести:
   - Домен для Steal-сайта.
   - Порт для подключения ноды.
   - Публичный ключ панели для ноды.

## Защита панели на основе URL-параметра

В Caddy добавлена дополнительная защита от обнаружения панели:

- Для доступа к панели необходимо открыть страницу вида:

  ```
  https://ВАШ_ДОМЕН_ПАНЕЛИ/auth/login?caddy=<SECRET_KEY>
  ```

- Параметр `?caddy=<SECRET_KEY>` устанавливает специальную Cookie `caddy=<SECRET_KEY>` в браузере.
- Если Cookie не установлена или параметр в запросе отсутствует, при обращении к панели пользователь увидит пустую страницу или ошибку 404 (в зависимости от запрошенного пути).

Таким образом, даже если злоумышленник будет сканировать хост или перебирать пути, без точного параметра и/или Cookie панель останется невидимой.

## Управление сервисами

После установки вы можете управлять сервисами с помощью команды `make` в соответствующих директориях:

- **Директория панели**: `~/remnawave/panel`
- **Директория Caddy**: `~/remnawave/caddy`
- **Директория remnawave-subscription-page**: `~/remnawave/remnawave-subscription-page`

- **Директория ноды**: `~/remnanode/node`
- **Директория сайта-заглушки**: `~/remnanode/selfsteal`

Доступные команды:

- `make start` — Запуск сервиса и просмотр логов
- `make stop` — Остановка сервиса
- `make restart` — Перезапуск сервиса
- `make update` — Обновление сервиса
- `make logs` — Просмотр логов

## Работа с remnawave-subscription-page

При установке `remnawave-subscription-page` создаются следующие шаблоны:

- Шаблон V2Ray:
  ```
  ~/remnawave/remnawave-subscription-page/templates/v2ray/default.json
  ```
- Шаблон V2Ray Mux:
  ```
  ~/remnawave/remnawave-subscription-page/templates/mux/default.json
  ```
- Шаблон страницы подписки:
  ```
  ~/remnawave/remnawave-subscription-page/templates/subscription/index.html
  ```

Для изменения шаблонов:

1. Перейдите в директорию `~/remnawave/remnawave-subscription-page` и выполните `make stop`.
2. Отредактируйте нужные файлы шаблонов.
3. Запустите сервисы снова: `make start`.

## Примечания

- Убедитесь, что у вас настроены DNS-записи для **всех** указанных доменов, направляющие на IP-адрес соответствующего сервера.

## Благодарности

- [AsanFillter](https://github.com/AsanFillter/Remnawave-AutoSetup) за Remnawave-AutoSetup
- [eGamesAPI](https://github.com/eGamesAPI/remnawave-reverse-proxy) за remnawave-reverse-proxy
