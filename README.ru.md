## Remnawave Installer

Этот скрипт предназначен для автоматизированной установки панели и ноды **Remnawave**.

**ВАЖНО!** НЕ ИСПОЛЬЗУЙТЕ ПАНЕЛЬ В PRODUCTION без полного понимания, что и как работает!!!

Этот скрипт предназначен только для демонстрации работы Remnawave!

Вы можете использовать Remnawave двумя способами:

- **Вариант 1 (Два сервера)**: Установка панели и ноды на разных серверах (рекомендуется)
- **Вариант 2 (Всё в одном)**: Установка панели и ноды на одном сервере (упрощенная установка)

### Вариант 1: Два сервера

Для полноценного использования вам понадобятся два отдельных свежих сервера на Ubuntu 22.04:

- Сервер для панели - он будет центром управления, но не будет содержать Xray ноду
- Сервер для ноды - он будет содержать Remnawave ноду и заглушку Self Steal для VLESS REALITY

Вам потребуется три домена (поддомена): один для панели, второй — для подписок и третий — для сайта-заглушки Self Steal, который размещается на сервере с нодой.

**Важно про настройку DNS:**

- Домены панели и подписок должны указывать на IP-адрес сервера с панелью
- Домен для сайта-заглушки Self Steal должен указывать на IP-адрес сервера с нодой

Рекомендуемый порядок установки:

1. Сначала установите панель и получите публичный ключ для вашей ноды.
2. Затем установите ноду, указав ранее полученный ключ.

### Вариант 2: Всё в одном

В этом варианте вы можете развернуть и панель, и ноду на одном сервере, что снизит надежность, но не требует 2 серверов.

Этот вариант автоматически настраивает взаимодействие между панелью и нодой, что упрощает процесс установки и управления.

В этой конфигурации Remnawave нода (Xray в ней) обрабатывает весь входящий трафик на 443 порту. Все запросы, которые не являются Xray-proxy-соединениями уходят в dest fallback и перенаправляются в Caddy, который затем распределяет их по нужным сервисам (панель, selfsteal, подписки в зависимости от sni). Если в этом режиме остановить локальную Remnawave ноду, то панель перестанет быть доступна, в этом случае нужно выбрать в меню пункт "Открыть доступ к панели напрямую - я сломал Xray конфиг/ноду".

```
Клиент → 443 порт → Xray → (Прокси-соединения)
                      ↓
                     Caddy → Панель/Подписки/Selfsteal (в зависимости от SNI)
```

## Системные требования

- ОС: Ubuntu 22.04, 2 гб RAM, 2 CPU Core (меньше можно, но не рекомендуется, особенно для All-in-One установки c Caddy Auth)
- Пользователь с правами root (sudo)

## Установка

Для запуска установщика выполните следующую команду в терминале:

```bash
bash <(curl -Ls https://raw.githubusercontent.com/xxphantom/remnawave-installer/refs/heads/main/dist/install_remnawave.sh)
```

<p align="center"><img src="./assets/menu.png" alt="Remnawave Installer Menu"></p>

## Вариант защиты панели на основе Cookie и URL-параметра

В Caddy добавлена дополнительная защита от обнаружения панели:

- Для доступа к панели необходимо открыть страницу вида:

  ```
  https://ВАШ_ДОМЕН_ПАНЕЛИ/auth/login?caddy=<SECRET_KEY>
  ```

- Параметр `?caddy=<SECRET_KEY>` устанавливает специальную Cookie `caddy=<SECRET_KEY>` в браузере.
- Если Cookie не установлена или параметр в запросе отсутствует, при обращении к панели пользователь увидит пустую страницу или ошибку 404 (в зависимости от запрошенного пути).

Таким образом, даже если злоумышленник будет сканировать хост или перебирать пути, без точного параметра и/или Cookie панель останется невидимой.

## Вариант защиты панели на основе Caddy Auth (рекомендуется)

Caddy Auth представляет собой полноценную систему аутентификации и авторизации, которая обеспечивает максимальный уровень безопасности для панели Remnawave.

### Архитектура безопасности

При использовании FULL Caddy Security создается двухуровневая система защиты:

1. **Первый уровень - Caddy Auth Portal**: Пользователь сначала проходит аутентификацию в Caddy Auth
2. **Второй уровень - Remnawave Panel**: После успешной аутентификации в Caddy Auth пользователь получает доступ к панели Remnawave

### Ключевые особенности

#### Многофакторная аутентификация (MFA)
- **Обязательная настройка MFA**: Система требует настройки двухфакторной аутентификации
- **Поддержка TOTP**: Совместимость с Google Authenticator, Authy, Microsoft Authenticator и другими приложениями
- **Безопасность**: Даже при компрометации пароля доступ остается защищенным


#### Безопасные маршруты
- **Случайные пути**: Автоматическая генерация уникальных путей для доступа к панели
- **Скрытие панели**: Панель недоступна по стандартным путям
- **Защита от сканирования**: Затрудняет обнаружение панели автоматическими сканерами

### Процесс доступа к панели

1. **Переход по защищенному URL**: `https://ВАШ_ДОМЕН/<СЛУЧАЙНЫЙ_ПУТЬ>/auth`
2. **Аутентификация в Caddy Auth**: Ввод логина и пароля
3. **Подтверждение MFA**: Ввод кода из приложения-аутентификатора
5. **Доступ к панели**: Вход в Remnawave с отдельными учетными данными

### Учетные данные

При установке создаются два набора учетных данных:

#### Caddy Auth (первый уровень защиты)
- **Логин**: Автоматически сгенерированный
- **Пароль**: Сложный пароль (25 символов)
- **Email**: Указывается при установке
- **MFA**: Настраивается при первом входе

#### Remnawave Panel (второй уровень)
- **Логин**: Автоматически сгенерированный SuperAdmin
- **Пароль**: Сложный пароль (25 символов)

## Управление сервисами

После установки вы можете управлять сервисами с помощью команды `make` в соответствующих директориях:

### Для варианта "Два сервера":

- **Директория панели**: `/opt/remnawave`
- **Директория Caddy**: `/opt/remnawave/caddy`
- **Директория remnawave-subscription-page**: `/opt/remnawave/remnawave-subscription-page`

- **Директория ноды**: `/opt/remnanode/node`
- **Директория сайта-заглушки**: `/opt/remnanode/selfsteal`

### Для варианта "Всё в одном":

- **Директория панели**: `/opt/remnawave`
- **Директория Caddy**: `/opt/remnawave/caddy`
- **Директория ноды**: `/opt/remnawave/node`

Доступные команды:

- `make start` — Запуск и просмотр логов
- `make stop` — Остановка
- `make restart` — Перезапуск
- `make logs` — Просмотр логов

## Примечания

- Убедитесь, что у вас настроены DNS-записи для **всех** указанных доменов, направляющие на IP-адрес соответствующего сервера.
- При использовании варианта "Всё в одном" один домен используется для всех сервисов (панель, подписки, Self Steal).
